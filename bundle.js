(()=>{"use strict";class t{#t;constructor(t,e,i,s,h,r,o,n,a){this.#t=[t,e,i,s,h,r,o,n,a]}set(t,e,i,s,h,r,o,n,a){return this.#t[0]=t,this.#t[1]=e,this.#t[2]=i,this.#t[3]=s,this.#t[4]=h,this.#t[5]=r,this.#t[6]=o,this.#t[7]=n,this.#t[8]=a,this}copy(){return new t(...this.#t)}multiply(t){const e=this.#t,i=t.#t,s=[0,0,0,0,0,0,0,0,0];return s[0]=e[0]*i[0]+e[1]*i[3]+e[2]*i[6],s[1]=e[0]*i[1]+e[1]*i[4]+e[2]*i[7],s[2]=e[0]*i[2]+e[1]*i[5]+e[2]*i[8],s[3]=e[3]*i[0]+e[4]*i[3]+e[5]*i[6],s[4]=e[3]*i[1]+e[4]*i[4]+e[5]*i[7],s[5]=e[3]*i[2]+e[4]*i[5]+e[5]*i[8],s[6]=e[6]*i[0]+e[7]*i[3]+e[8]*i[6],s[7]=e[6]*i[1]+e[7]*i[4]+e[8]*i[7],s[8]=e[6]*i[2]+e[7]*i[5]+e[8]*i[8],this.#t=s,this}get data(){return this.#t}static identity(){return new t(1,0,0,0,1,0,0,0,1)}static translation(e,i){return new t(1,0,e,0,1,i,0,0,1)}static rotation(e){const i=Math.cos(e),s=Math.sin(e);return new t(i,-s,0,s,i,0,0,0,1)}static scale(e,i){return new t(e,0,0,0,i,0,0,0,1)}}class e{#e=0;#i=0;#s=0;#h=0;constructor(t,e){this.x=t,this.y=e}set(t){return this.x=t.x,this.y=t.y,this}copy({x:t=this.x,y:i=this.y}={}){return new e(t,i)}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t,this.y/=t,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}transform(t){const{x:e,y:i}=this,s=t.data;return this.x=e*s[0]+i*s[1]+1*s[2],this.y=e*s[3]+i*s[4]+1*s[5],this}translate(e){return this.transform(t.translation(e.x,e.y))}rotate(e){return this.transform(t.rotation(e))}scale(e){return this.transform(t.scale(e.x,e.y))}normalize(){const t=this.magnitude;return 0!==t&&this.divide(t),this}set x(t){this.#e=t,this.#s=Math.atan2(this.#i,t),this.#h=Math.sqrt(t**2+this.#i**2)}get x(){return this.#e}set y(t){this.#i=t,this.#s=Math.atan2(t,this.#e),this.#h=Math.sqrt(this.#e**2+t**2)}get y(){return this.#i}set theta(t){this.#s=t,this.#e=this.#h*Math.cos(t),this.#i=this.#h*Math.sin(t)}get theta(){return this.#s}set magnitude(t){this.#h=t,this.#e=t*Math.cos(this.#s),this.#i=t*Math.sin(this.#s)}get magnitude(){return this.#h}set r(t){this.magnitude=t}get r(){return this.magnitude}static add(t,i){return new e(t.x,t.y).add(i)}static subtract(t,i){return new e(t.x,t.y).subtract(i)}static multiply(t,i){return new e(t.x,t.y).multiply(i)}static divide(t,i){return new e(t.x,t.y).divide(i)}static dot(t,i){return new e(t.x,t.y).dot(i)}static cross(t,i){return new e(t.x,t.y).cross(i)}static transform(t,i){return new e(t.x,t.y).transform(i)}static translate(t,i){return new e(t.x,t.y).translate(i)}static rotate(t,i){return new e(t.x,t.y).rotate(i)}static scale(t,i){return new e(t.x,t.y).scale(i)}static normalize(t){return new e(t.x,t.y).normalize()}static fromPolar(t,i){return new e(i*Math.cos(t),i*Math.sin(t))}}class i{#r;#o;#n;#a=new e(0,0);#l="#fff";#c="#fff";#d=1;#u=[];#g=0;#p="start";#y="alphabetic";#x="10px sans-serif";#f=1;#w=1;constructor(t,e,i){this.#r=t,this.#o=document.getElementById(t),this.#n=this.#o.getContext("2d"),this.fillStyle="#fff",this.strokeStyle="#fff",this.lineWidth=1,this.lineDash=[],this.lineDashOffset=0,this.textAlign="start",this.textBaseline="alphabetic",this.font="10px sans-serif",this.globalAlpha=1,this.resize(e,i)}resize(t,i){return this.#o.width=t,this.#o.height=i,this.#w=t/i,this.#a=new e(+(t/2).toFixed(4),+(i/2).toFixed(4)),this}drawImage(t,e,i,s){return this.context.drawImage(t,e.x,e.y,i,s),this}rotateAndDrawImage(t,e,i,s,h){return this.save().translate(e).rotate(-h).drawImage(t,{x:-i/2,y:-s/2},i,s).restore(),this}circle(t,e){return this.context.arc(t.x,t.y,e,0,2*Math.PI),this}rect(t,e,i){return this.context.rect(t.x,t.y,e,i),this}line(t,e){return this.context.moveTo(t.x,t.y),this.context.lineTo(e.x,e.y),this}moveTo(t){return this.context.moveTo(t.x,t.y),this}lineTo(t){return this.context.lineTo(t.x,t.y),this}text({text:t,at:e,fillStyle:i=this.#l,strokeStyle:s=this.#c,size:h=16}){return this.beginPath(),this.textAlign="center",this.textBaseline="middle",this.fillStyle=i,this.strokeStyle=s,this.font=`${h}px Arial`,this.context.fillText(t,e.x,e.y),this.context.strokeText(t,e.x,e.y),this}beginPath(){return this.context.beginPath(),this}closePath(){return this.context.closePath(),this}stroke({color:t=this.#c,width:e=this.#d,dash:i=this.#u}={}){return this.save(),this.strokeStyle=t,this.lineWidth=e,this.lineDash=i,this.context.stroke(),this.restore(),this}fill(t=this.#l){return this.fillStyle=t,this.context.fill(),this}background(t="#000"){return this.#o.style.backgroundColor=t,this}clear(){return this.context.clearRect(0,0,this.width,this.height),this}translate(t){return this.context.translate(t.x,t.y),this}rotate(t){return this.context.rotate(t),this}save(){return this.context.save(),this}restore(){return this.context.restore(),this}requestPointerLock(){return this.#o.requestPointerLock(),this}set fillStyle(t){this.#l=t,this.context.fillStyle=t}set strokeStyle(t){this.#c=t,this.context.strokeStyle=t}set lineWidth(t){this.#d=t,this.context.lineWidth=t}set lineDash(t){this.#u=t,this.context.setLineDash(Array.from(t))}set lineDashOffset(t){this.#g=t,this.context.lineDashOffset=t}set textAlign(t){this.#p=t,this.context.textAlign=t}set textBaseline(t){this.#y=t,this.context.textBaseline=t}set font(t){this.#x=t,this.context.font=t}set globalAlpha(t){this.#f=t,this.context.globalAlpha=t}get id(){return this.#r}get canvas(){return this.#o}get context(){if(!this.#n)throw new Error("CanvasRenderingContext2D is null");return this.#n}get center(){return this.#a}get width(){return this.#o.width}get height(){return this.#o.height}get aspectRatio(){return this.#w}get fillStyle(){return this.#l}get strokeStyle(){return this.#c}get lineWidth(){return this.#d}get lineDash(){return this.#u}get lineDashOffset(){return this.#g}get textAlign(){return this.#p}get textBaseline(){return this.#y}get font(){return this.#x}get globalAlpha(){return this.#f}}class s{#b;#m;#v;#P;#O;#S;constructor(t,i){this.#v=Math.abs(i.x-t.x),this.#P=Math.abs(i.y-t.y),this.#O=this.#v/2,this.#S=this.#P/2,this.#b=new e(this.#O+t.x,this.#S+t.y),this.#m=this.#b.copy()}reset(){this.#m=this.#b.copy()}move(t){this.#m.add(t)}collide(t){return t.left<this.right&&t.right>this.left&&t.top<this.bottom&&t.bottom>this.top}get position(){return this.#m}get topLeft(){return e.subtract(this.#m,{x:this.#O,y:this.#S})}get bottomRight(){return e.add(this.#m,{x:this.#O,y:this.#S})}get top(){return this.#m.y-this.#S}get bottom(){return this.#m.y+this.#S}get left(){return this.#m.x-this.#O}get right(){return this.#m.x+this.#O}get x(){return this.#m.x}get y(){return this.#m.y}get width(){return this.#v}get height(){return this.#P}}class h extends s{#A;#T=0;#D=0;#I=null;constructor({position:t,size:e=20,brain:i}){const s=.5*e;super({x:t.x-s,y:t.y-s},{x:t.x+s,y:t.y+s}),this.#A=e,i&&(this.#I=i)}reset(){super.reset(),this.#T=0,this.#D=0}jump(){this.#T=h.#k}update(){this.#T=Math.max(Math.min(this.#T+h.#E,h.#M),h.#k);const t={x:0,y:this.#T};this.move(t)}incrementScore(){this.#D++}get normalizedVelocity(){return(this.#T-h.#k)/h.#M}get size(){return this.#A}get score(){return this.#D}get brain(){return this.#I}static#M=40;static#k=-8;static#E=.5}class r{#m;#N;#L;constructor(t,i){i=Math.min(r.#B-r.#_/2-r.#R,Math.max(r.#Y+r.#_/2+r.#R,i)),this.#m=new e(t,i);const h=.5*r.#W,o=.5*r.#_;this.#N=new s({x:t-h,y:r.#Y},{x:t+h,y:i-o}),this.#L=new s({x:t-h,y:i+o},{x:t+h,y:r.#B})}update(t,i){const s=e.multiply({x:-2,y:0},t*i);this.#N.move(s),this.#L.move(s),this.#m.add(s)}nextIfThereIsSpaceTo(t){const e=this.#G();return e.x<t+r.#W/2?new r(e.x,e.y):null}#G(){const t=this.#m.x+r.#W+r.#z,e=100*Math.random()+100,i=this.#m.y-e<r.#Y+r.#_/2+r.#R,s=this.#m.y+e>r.#B-r.#_/2-r.#R;let h=this.#m.y;return i?h+=e:s?h-=e:h+=e*Math.sign(Math.random()-.5),{x:t,y:h}}get left(){return this.#m.x-r.#W/2}get right(){return this.#m.x+r.#W/2}get top(){return this.#N}get bottom(){return this.#L}static#_=150;static#W=50;static#z=300;static#Y=0;static#B=0;static#R=20;static set TOP_BOUNDARY(t){r.#Y=t}static set BOTTOM_BOUNDARY(t){r.#B=t}static get SIZE(){return r.#W}}class o{#H=0;#U=0;constructor(t){this.#U=t}set value(t){this.#H=t}get value(){return this.#H}get bias(){return this.#U}}class n{#C=[];constructor(t,e){for(let i=0;i<t;i++)this.#C.push(new o("number"==typeof e?e:2*Math.random()-1))}get nodes(){return this.#C}}class a{#V;#F;#Z;constructor(t,e,i){this.#V=t,this.#F=e,this.#Z=i}get from(){return this.#V}get to(){return this.#F}get weight(){return this.#Z}}class l{#q;#j;#K;constructor(t,e){this.#q=t,this.#j=e,this.#K=[];for(const i of t.nodes)for(const t of e.nodes)this.#K.push(new a(i,t,2*Math.random()-1))}feedForward(){for(const t of this.#K)t.to.value+=t.from.value*t.weight;for(const t of this.#j.nodes)t.value=1/(1+Math.exp(-t.value-t.bias))}get inputLayer(){return this.#q}get outputLayer(){return this.#j}get edges(){return this.#K}}class c{#X;#$;constructor(t,e,i){this.#$=[new n(t,0),...e.map((t=>new n(t))),new n(i)],this.#X=[];for(let t=0;t<this.#$.length-1;t++)this.#X.push(new l(this.#$[t],this.#$[t+1]))}feedForward(t){this.#$[0].nodes.forEach(((e,i)=>{e.value=t[i]}));for(const t of this.#X)t.feedForward();return this.#$[this.#$.length-1].nodes.map((t=>t.value))}get levels(){return this.#X}get layers(){return this.#$}}class d{#J;#o;#Q;#tt=0;#et=[];#it=!1;#st;#ht=!1;#N;#L;#rt;#ot;constructor(t){this.#J=new s({x:0,y:0},{x:t.width,y:t.height}),this.#N=this.#J.top+20,this.#L=this.#J.bottom-20,this.#rt=new s({x:0,y:0},{x:this.#J.right,y:this.#N}),this.#ot=new s({x:0,y:this.#L},{x:this.#J.right,y:this.#J.bottom}),r.TOP_BOUNDARY=this.#N,r.BOTTOM_BOUNDARY=this.#L,this.#st=d.#nt,this.#o=t,this.#Q=new h({position:this.#J.position.copy({x:100}),brain:new c(7,[4],1)}),this.#et=this.#at(),window.addEventListener("keydown",(t=>{" "!==t.key&&"ArrowUp"!==t.key||this.#Q.jump()})),window.addEventListener("click",(()=>this.#Q.jump())),this.load()}#at(){const t=[];let e=new r(this.#J.position.x,this.#J.position.y);for(t.push(e);;){const i=e.nextIfThereIsSpaceTo(this.#J.right);if(null===i)break;t.push(i),e=i}return t}reset(){this.save(),this.#Q.score>this.#tt&&(this.#tt=this.#Q.score),this.#Q.reset(),this.#it=!1,this.#et=this.#at(),this.#st=d.#nt}save(){localStorage.setItem(d.#lt,this.#tt.toString())}load(){this.#tt=+(localStorage.getItem(d.#lt)??0)}update(t){this.#st+=.001,this.#Q.update();for(const e of this.#et)e.update(t,this.#st);this.#et[0].right<0&&this.#et.shift();const e=this.#ct();(this.#Q.brain?.feedForward([this.#Q.top/this.#J.height,this.#Q.bottom/this.#J.height,this.#Q.normalizedVelocity,e.top.bottom/this.#J.height,e.bottom.top/this.#J.height,e.left/this.#J.width,e.right/this.#J.width])||[0])[0]>.5&&this.#Q.jump();const i=this.#et.at(-1);if(i){const t=i.nextIfThereIsSpaceTo(this.#J.right);t&&this.#et.push(t)}(this.#rt.collide(this.#Q)||this.#ot.collide(this.#Q))&&(this.#it=!0),e===this.#et[1]?this.#ht||(this.#Q.incrementScore(),this.#ht=!0):this.#ht=!1,this.#dt(e)&&(this.#it=!0),this.#it&&this.reset()}#dt({top:t,bottom:e}){return t.collide(this.#Q)||e.collide(this.#Q)}#ct(){return[this.#et[0],this.#et[1]].find((t=>t.right>this.#Q.left))}render(){this.#o.beginPath().rect(this.#rt.topLeft,this.#rt.width,this.#rt.height).rect(this.#ot.topLeft,this.#ot.width,this.#ot.height).closePath().fill("#0f0").stroke({color:"#000",width:2});for(const{top:t,bottom:e}of this.#et)this.#o.beginPath().rect(t.topLeft,t.width,t.height).rect(e.topLeft,e.width,e.height).closePath().fill("#0f0").stroke({color:"black",width:2});const t=this.#ct();this.#o.beginPath().rect(t.top.topLeft,t.top.width,t.top.height).rect(t.bottom.topLeft,t.bottom.width,t.bottom.height).closePath().fill("#f00").stroke({color:"black",width:2}),this.#o.beginPath().circle(this.#Q.position,this.#Q.size/2).closePath().fill("#ff0").stroke({color:"black",width:2}),this.#o.text({text:`Best score: ${this.#tt}`,at:this.#o.center.copy().subtract({x:0,y:130}),fillStyle:"#fff",strokeStyle:"transparent"}).text({text:this.#Q.score.toString(),at:this.#o.center.copy().subtract({x:0,y:100}),size:36,fillStyle:"#fff",strokeStyle:"#fff"})}renderNetwork(t){if(!this.#Q.brain)return;const e=t.width-80,i=t.height-20,s=e/(this.#Q.brain.layers.length-1);let h=40;for(const e of this.#Q.brain.levels){const r=h,o=h+s,n=i/e.inputLayer.nodes.length,a=i/e.outputLayer.nodes.length;let l=10+n/2;for(let i=0;i<e.inputLayer.nodes.length;i++){let s=10+a/2;for(let h=0;h<e.outputLayer.nodes.length;h++){const n=e.edges[i*e.outputLayer.nodes.length+h];t.beginPath().line({x:r,y:l},{x:o,y:s}).closePath().stroke({color:n.weight<0?"#f00":"#00f",width:Math.abs(2*n.weight)+1}),s+=a}l+=n}h+=s}h=40;for(const e of this.#Q.brain.layers){const r=i/e.nodes.length;let o=10+r/2;for(const i of e.nodes)t.beginPath().circle({x:h,y:o},10).closePath().fill("#012").fill(`rgba(255, 255, 0, ${Math.abs(i.value).toFixed(2)})`).stroke({color:i.bias<0?"#f00":"#00f",width:2}),o+=r;h+=s}}get bird(){return this.#Q}get isOver(){return this.#it}static#nt=1;static#lt="highscore"}const u=new i("network",600,300);u.background("#012");const g=new i("canvas",innerWidth,innerHeight);g.background("skyblue");const p=new d(g);let y=0;!function t(e){const i=(e-y)/15;y=e,p.update(i),g.clear(),p.render(),u.clear(),p.renderNetwork(u),requestAnimationFrame(t)}(0),addEventListener("resize",(()=>{g.resize(innerWidth,innerHeight),p.render()}))})();