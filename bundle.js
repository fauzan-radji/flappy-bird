(()=>{"use strict";var t,e,i,s,r={993:(t,e,i)=>{i.d(e,{A:()=>p});var s=i(992);class r{#t;#e;#i;#s;#r;#n;constructor(t,e){this.#i=Math.abs(e.x-t.x),this.#s=Math.abs(e.y-t.y),this.#r=this.#i/2,this.#n=this.#s/2,this.#t=new s.A(this.#r+t.x,this.#n+t.y),this.#e=this.#t.copy()}reset(){this.#e=this.#t.copy()}move(t){this.#e.add(t)}collide(t){return t.left<this.right&&t.right>this.left&&t.top<this.bottom&&t.bottom>this.top}get position(){return this.#e}get topLeft(){return s.A.subtract(this.#e,{x:this.#r,y:this.#n})}get bottomRight(){return s.A.add(this.#e,{x:this.#r,y:this.#n})}get top(){return this.#e.y-this.#n}get bottom(){return this.#e.y+this.#n}get left(){return this.#e.x-this.#r}get right(){return this.#e.x+this.#r}get x(){return this.#e.x}get y(){return this.#e.y}get width(){return this.#i}get height(){return this.#s}}class n extends r{#h;#o=0;#a=0;#l;constructor({position:t,size:e=20,brain:i}){const s=.5*e;super({x:t.x-s,y:t.y-s},{x:t.x+s,y:t.y+s}),this.#h=e,this.#l=i}reset(){super.reset(),this.#o=0,this.#a=0}jump(){this.#o=n.#c}update(){this.#o=Math.max(Math.min(this.#o+n.#u,n.#p),n.#c);const t={x:0,y:this.#o};this.move(t)}incrementScore(){this.#a++}get normalizedVelocity(){return(this.#o-n.#c)/n.#p}get size(){return this.#h}get score(){return this.#a}get brain(){return this.#l}static#p=40;static#c=-8;static#u=.5}class h{#e;#g;#d;constructor(t,e){e=Math.min(h.#f-h.#x/2-h.#y,Math.max(h.#m+h.#x/2+h.#y,e)),this.#e=new s.A(t,e);const i=.5*h.#w,n=.5*h.#x;this.#g=new r({x:t-i,y:h.#m},{x:t+i,y:e-n}),this.#d=new r({x:t-i,y:e+n},{x:t+i,y:h.#f})}update(t,e){const i=s.A.multiply({x:-2,y:0},t*e);this.#g.move(i),this.#d.move(i),this.#e.add(i)}nextIfThereIsSpaceTo(t){const e=this.#b();return e.x<t+h.#w/2?new h(e.x,e.y):null}#b(){const t=this.#e.x+h.#w+h.#v,e=100*Math.random()+100,i=this.#e.y-e<h.#m+h.#x/2+h.#y,s=this.#e.y+e>h.#f-h.#x/2-h.#y;let r=this.#e.y;return i?r+=e:s?r-=e:r+=e*Math.sign(Math.random()-.5),{x:t,y:r}}get left(){return this.#e.x-h.#w/2}get right(){return this.#e.x+h.#w/2}get top(){return this.#g}get bottom(){return this.#d}static#x=150;static#w=50;static#v=300;static#m=0;static#f=0;static#y=20;static set TOP_BOUNDARY(t){h.#m=t}static set BOTTOM_BOUNDARY(t){h.#f=t}static get SIZE(){return h.#w}}class o{#A;constructor(){this.#A=2*Math.random()-1}mutate(t){const e=new o;var i;return e.#A=(i=this.#A)+(2*Math.random()-1-i)*t,e}toJSON(){return this.#A}get weight(){return this.#A}static create(t){const e=new o;return e.#A=t,e}}class a{#S=0;#O=0;#I=[];constructor(t,e){this.#O="number"==typeof e?e:2*Math.random()-1,this.#I=t}mutate(t){return new a(this.#I.map((e=>e.mutate(t))),(e=this.#O)+(2*Math.random()-1-e)*t);var e}toJSON(){return{bias:this.#O,edges:this.#I.map((t=>t.toJSON()))}}set value(t){this.#S=t}get value(){return this.#S}get bias(){return this.#O}get edges(){return this.#I}static create({bias:t,edges:e}){return new a(e.map((t=>o.create(t))),t)}}class l{#P=[];constructor(t){this.#P=t}feedForward(t){for(const e of this.#P){const i=e.edges.reduce(((e,i,s)=>e+t.#P[s].value*i.weight),0);e.value=1/(1+Math.exp(-i-e.bias))}}mutate(t){return new l(this.#P.map((e=>e.mutate(t))))}toJSON(){return this.#P.map((t=>t.toJSON()))}get nodes(){return this.#P}static create(t){return new l(t.map((t=>a.create(t))))}}class c{#T;#N;#E;#_;constructor(t,e,i){this.#T=t,this.#N=e,this.#E=i;const s=new l(Array.from({length:t},(()=>new a([],0)))),r=[new l(Array.from({length:e[0]},(()=>new a(Array.from({length:t},(()=>new o))))))];for(let i=1;i<e.length;i++)r.push(new l(Array.from({length:e[i-1]},(()=>new a(Array.from({length:t},(()=>new o)))))));const n=new l(Array.from({length:i},(()=>new a(Array.from({length:e[e.length-1]},(()=>new o))))));this.#_=[s,...r,n]}feedForward(t){this.#_[0].nodes.forEach(((e,i)=>{e.value=t[i]}));for(let t=1;t<this.#_.length;t++)this.#_[t].feedForward(this.#_[t-1]);return this.#_[this.#_.length-1].nodes.map((t=>t.value))}mutate(t){const e=new c(this.#T,this.#N,this.#E);for(let i=1;i<this.#_.length;i++)e.#_[i]=this.#_[i].mutate(t);return e}toJSON(){return{input:this.#T,hidden:this.#N,output:this.#E,layers:this.#_.map((t=>t.toJSON()))}}get layers(){return this.#_}static from(t){const{input:e,hidden:i,output:s,layers:r}=JSON.parse(t),n=new c(e,i,s);for(let t=0;t<r.length;t++)n.#_[t]=l.create(r[t]);return n}}class u{#B;#h;#D;#M=null;#k;#R;constructor(t,e,i){this.#B=1,this.#h=t,this.#D=Array.from({length:t},e),this.#R=e,this.#k=i}update(){if(0===this.remaining)return;const t=this.#D.reduce(((t,e)=>this.#k(e)>this.#k(t)?e:t),this.#D[0]),e=this.#k(t);e>0&&(!this.#M||e>this.#k(this.#M))&&(this.#M||console.log("no best"),this.#M=t)}eliminate(t){this.#D.splice(t,1)}nextGeneration(){this.#B++;const t=[];for(let e=0;e<this.#h;e++)t.push(this.#R(this.#M??void 0));this.#M&&(t[0]=this.#M),this.#D=t}get number(){return this.#B}get population(){return this.#D}get best(){return this.#M}get remaining(){return this.#D.length}}class p{#z;#Y;#G=0;#U=[];#W=!1;#H;#L=!1;#g;#d;#C;#V;#Z;#J=null;constructor(t,e){this.load(e),this.#z=new r({x:0,y:0},{x:t.width,y:t.height}),this.#g=this.#z.top+20,this.#d=this.#z.bottom-20,this.#C=new r({x:0,y:0},{x:this.#z.right,y:this.#g}),this.#V=new r({x:0,y:this.#d},{x:this.#z.right,y:this.#z.bottom}),h.TOP_BOUNDARY=this.#g,h.BOTTOM_BOUNDARY=this.#d,this.#H=p.#F,this.#Y=t,this.#Z=new u(p.#q,(t=>new n({position:this.#z.position.copy({x:100}),brain:t&&t.brain?t.brain.mutate(p.#K):this.#J?this.#J.mutate(p.#K):new c(p.#j,p.#$,p.#X)})),(t=>t.score)),this.#J&&(this.#Z.population[0]=new n({position:this.#z.position.copy({x:100}),brain:this.#J})),this.#U=this.#Q()}#Q(){const t=[];let e=new h(this.#z.position.x,this.#z.position.y);for(t.push(e);;){const i=e.nextIfThereIsSpaceTo(this.#z.right);if(null===i)break;t.push(i),e=i}return t}reset(){this.save();const t=this.#Z.best;t&&(t.score>this.#G&&(this.#G=t.score),t.reset()),this.#Z.nextGeneration(),this.#W=!1,this.#U=this.#Q(),this.#H=p.#F}save(){localStorage.setItem(p.#tt,this.#G.toString()),this.#Z.best&&(this.#J=this.#Z.best.brain,localStorage.setItem(p.#et,JSON.stringify(this.#J)))}load(t){this.#G=+(localStorage.getItem(p.#tt)??0);let e=localStorage.getItem(p.#et);e||(localStorage.setItem(p.#et,t),e=t),this.#J=c.from(t)}update(t){this.#H+=1e-4;for(const e of this.#U)e.update(t,this.#H);this.#U[0].right<0&&this.#U.shift();const e=this.#it();this.#Z.population.forEach(((t,i)=>{t.update(),(t.brain?.feedForward([t.top/this.#z.height,t.bottom/this.#z.height,t.normalizedVelocity,e.top.bottom/this.#z.height,e.bottom.top/this.#z.height,e.left/this.#z.width,e.right/this.#z.width])||[0])[0]>.5&&t.jump(),(this.#C.collide(t)||this.#V.collide(t))&&this.#Z.eliminate(i),this.#st(e,t)&&this.#Z.eliminate(i)})),this.#Z.update();const i=this.#U.at(-1);if(i){const t=i.nextIfThereIsSpaceTo(this.#z.right);t&&this.#U.push(t)}if(e===this.#U[1]){if(!this.#L){for(const t of this.#Z.population)t.incrementScore();this.#L=!0}}else this.#L=!1;0===this.#Z.remaining&&(this.#W=!0),this.#W&&this.reset()}#st({top:t,bottom:e},i){return t.collide(i)||e.collide(i)}#it(){return[this.#U[0],this.#U[1]].find((t=>t.right>this.#Z.population[0].left))}render(){this.#Y.beginPath().rect(this.#C.topLeft,this.#C.width,this.#C.height).rect(this.#V.topLeft,this.#V.width,this.#V.height).closePath().fill("#0f0").stroke({color:"#000",width:2});for(const{top:t,bottom:e}of this.#U)this.#Y.beginPath().rect(t.topLeft,t.width,t.height).rect(e.topLeft,e.width,e.height).closePath().fill("#0f0").stroke({color:"black",width:2});for(const t of this.#Z.population)this.#Y.beginPath().circle(t.position,.5*t.size).closePath().fill("#ff0").stroke({color:"black",width:2});this.#Y.text({text:`Best score: ${this.#G}`,at:this.#Y.center.copy().subtract({x:0,y:130}),fillStyle:"#fff",strokeStyle:"transparent"}).text({text:this.#Z.best?this.#Z.best.score.toString():this.#Z.population[0].score.toString(),at:this.#Y.center.copy().subtract({x:0,y:100}),size:36,fillStyle:"#fff",strokeStyle:"#fff"})}renderNetwork(t){const e=this.#Z.best||this.#Z.population[0];if(!e.brain)return;const i=t.width-80-20,s=t.height-60-10-20;t.context.textAlign="start",t.text({text:`Generation: ${this.#Z.number}`,at:{x:40,y:40},textAlign:"start",fillStyle:"#fff",strokeStyle:"transparent"}).text({text:`Population: ${this.#Z.remaining}`,at:{x:40,y:60},textAlign:"start",fillStyle:"#fff",strokeStyle:"transparent"});const r=i/(e.brain.layers.length-1);let n=50;for(let i=1;i<e.brain.layers.length;i++){const h=e.brain.layers[i-1],o=e.brain.layers[i],a=n,l=n+r,c=s/h.nodes.length,u=s/o.nodes.length;let p=60+.5*c+10;for(let e=0;e<h.nodes.length;e++){let i=60+.5*u+10;for(let s=0;s<o.nodes.length;s++){const r=o.nodes[s].edges[e];t.beginPath().line({x:a,y:p},{x:l,y:i}).closePath().stroke({color:r.weight<0?"#f00":"#00f",width:Math.abs(2*r.weight)+1}),i+=u}p+=c}n+=r}n=50;for(const i of e.brain.layers){const e=s/i.nodes.length;let h=60+.5*e+10;for(const s of i.nodes)t.beginPath().circle({x:n,y:h},10).closePath().fill("#012").fill(`rgba(255, 255, 0, ${Math.abs(s.value).toFixed(2)})`).stroke({color:s.bias<0?"#f00":"#00f",width:2}),h+=e;n+=r}}get isOver(){return this.#W}static#F=1;static#tt="highscore";static#et="brain";static#j=7;static#$=[4];static#X=1;static#K=.01;static#q=1e3}},156:(t,e,i)=>{i.a(t,(async(t,e)=>{try{var s=i(203),r=i(993);const n=new s.A("network",600,300);n.background("#012");const h=new s.A("canvas",innerWidth,innerHeight);h.background("skyblue");const o=await fetch("brain.json").then((t=>t.text())),a=new r.A(h,o);let l=0;function c(t){const e=(t-l)/15;l=t,a.update(e),h.clear(),a.render(),n.clear(),a.renderNetwork(n),requestAnimationFrame(c)}c(0),addEventListener("resize",(()=>{h.resize(innerWidth,innerHeight),a.render()})),e()}catch(u){e(u)}}),1)},203:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(992);class r{#rt;#Y;#nt;#ht=new s.A(0,0);#ot="#fff";#at="#fff";#lt=1;#ct=[];#ut=0;#pt="start";#gt="alphabetic";#dt="10px sans-serif";#ft=1;#xt=1;constructor(t,e,i){this.#rt=t,this.#Y=document.getElementById(t),this.#nt=this.#Y.getContext("2d"),this.fillStyle="#fff",this.strokeStyle="#fff",this.lineWidth=1,this.lineDash=[],this.lineDashOffset=0,this.textAlign="start",this.textBaseline="alphabetic",this.font="10px sans-serif",this.globalAlpha=1,this.resize(e,i)}resize(t,e){return this.#Y.width=t,this.#Y.height=e,this.#xt=t/e,this.#ht=new s.A(+(t/2).toFixed(4),+(e/2).toFixed(4)),this}drawImage(t,e,i,s){return this.context.drawImage(t,e.x,e.y,i,s),this}rotateAndDrawImage(t,e,i,s,r){return this.save().translate(e).rotate(-r).drawImage(t,{x:-i/2,y:-s/2},i,s).restore(),this}circle(t,e){return this.context.arc(t.x,t.y,e,0,2*Math.PI),this}rect(t,e,i){return this.context.rect(t.x,t.y,e,i),this}line(t,e){return this.context.moveTo(t.x,t.y),this.context.lineTo(e.x,e.y),this}moveTo(t){return this.context.moveTo(t.x,t.y),this}lineTo(t){return this.context.lineTo(t.x,t.y),this}text({text:t,at:e,textAlign:i="center",textBaseline:s="middle",fillStyle:r=this.#ot,strokeStyle:n=this.#at,size:h=16,font:o="Arial"}){return this.save(),this.context.textAlign=i,this.context.textBaseline=s,this.context.fillStyle=r,this.context.strokeStyle=n,this.context.font=`${h}px ${o}`,this.context.fillText(t,e.x,e.y),this.context.strokeText(t,e.x,e.y),this.restore(),this}beginPath(){return this.context.beginPath(),this}closePath(){return this.context.closePath(),this}stroke({color:t=this.#at,width:e=this.#lt,dash:i=this.#ct}={}){return this.save(),this.context.strokeStyle=t,this.context.lineWidth=e,this.context.setLineDash(Array.from(i)),this.context.stroke(),this.restore(),this}fill(t=this.#ot){return this.save(),this.context.fillStyle=t,this.context.fill(),this.restore(),this}background(t="#000"){return this.#Y.style.backgroundColor=t,this}clear(){return this.#Y.width=this.width,this.#Y.height=this.height,this}translate(t){return this.context.translate(t.x,t.y),this}rotate(t){return this.context.rotate(t),this}save(){return this.context.save(),this}restore(){return this.context.restore(),this}requestPointerLock(){return this.#Y.requestPointerLock(),this}set fillStyle(t){this.#ot=t,this.context.fillStyle=t}set strokeStyle(t){this.#at=t,this.context.strokeStyle=t}set lineWidth(t){this.#lt=t,this.context.lineWidth=t}set lineDash(t){this.#ct=t,this.context.setLineDash(Array.from(t))}set lineDashOffset(t){this.#ut=t,this.context.lineDashOffset=t}set textAlign(t){this.#pt=t,this.context.textAlign=t}set textBaseline(t){this.#gt=t,this.context.textBaseline=t}set font(t){this.#dt=t,this.context.font=t}set globalAlpha(t){this.#ft=t,this.context.globalAlpha=t}get id(){return this.#rt}get canvas(){return this.#Y}get context(){if(!this.#nt)throw new Error("CanvasRenderingContext2D is null");return this.#nt}get center(){return this.#ht}get width(){return this.#Y.width}get height(){return this.#Y.height}get aspectRatio(){return this.#xt}get fillStyle(){return this.#ot}get strokeStyle(){return this.#at}get lineWidth(){return this.#lt}get lineDash(){return this.#ct}get lineDashOffset(){return this.#ut}get textAlign(){return this.#pt}get textBaseline(){return this.#gt}get font(){return this.#dt}get globalAlpha(){return this.#ft}}},992:(t,e,i)=>{i.d(e,{A:()=>r});class s{#yt;constructor(t,e,i,s,r,n,h,o,a){this.#yt=[t,e,i,s,r,n,h,o,a]}set(t,e,i,s,r,n,h,o,a){return this.#yt[0]=t,this.#yt[1]=e,this.#yt[2]=i,this.#yt[3]=s,this.#yt[4]=r,this.#yt[5]=n,this.#yt[6]=h,this.#yt[7]=o,this.#yt[8]=a,this}copy(){return new s(...this.#yt)}multiply(t){const e=this.#yt,i=t.#yt,s=[0,0,0,0,0,0,0,0,0];return s[0]=e[0]*i[0]+e[1]*i[3]+e[2]*i[6],s[1]=e[0]*i[1]+e[1]*i[4]+e[2]*i[7],s[2]=e[0]*i[2]+e[1]*i[5]+e[2]*i[8],s[3]=e[3]*i[0]+e[4]*i[3]+e[5]*i[6],s[4]=e[3]*i[1]+e[4]*i[4]+e[5]*i[7],s[5]=e[3]*i[2]+e[4]*i[5]+e[5]*i[8],s[6]=e[6]*i[0]+e[7]*i[3]+e[8]*i[6],s[7]=e[6]*i[1]+e[7]*i[4]+e[8]*i[7],s[8]=e[6]*i[2]+e[7]*i[5]+e[8]*i[8],this.#yt=s,this}get data(){return this.#yt}static identity(){return new s(1,0,0,0,1,0,0,0,1)}static translation(t,e){return new s(1,0,t,0,1,e,0,0,1)}static rotation(t){const e=Math.cos(t),i=Math.sin(t);return new s(e,-i,0,i,e,0,0,0,1)}static scale(t,e){return new s(t,0,0,0,e,0,0,0,1)}}class r{#mt=0;#wt=0;#bt=0;#vt=0;constructor(t,e){this.x=t,this.y=e}set(t){return this.x=t.x,this.y=t.y,this}copy({x:t=this.x,y:e=this.y}={}){return new r(t,e)}add(t){return this.x+=t.x,this.y+=t.y,this}subtract(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t,this.y/=t,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}transform(t){const{x:e,y:i}=this,s=t.data;return this.x=e*s[0]+i*s[1]+1*s[2],this.y=e*s[3]+i*s[4]+1*s[5],this}translate(t){return this.transform(s.translation(t.x,t.y))}rotate(t){return this.transform(s.rotation(t))}scale(t){return this.transform(s.scale(t.x,t.y))}normalize(){const t=this.magnitude;return 0!==t&&this.divide(t),this}set x(t){this.#mt=t,this.#bt=Math.atan2(this.#wt,t),this.#vt=Math.sqrt(t**2+this.#wt**2)}get x(){return this.#mt}set y(t){this.#wt=t,this.#bt=Math.atan2(t,this.#mt),this.#vt=Math.sqrt(this.#mt**2+t**2)}get y(){return this.#wt}set theta(t){this.#bt=t,this.#mt=this.#vt*Math.cos(t),this.#wt=this.#vt*Math.sin(t)}get theta(){return this.#bt}set magnitude(t){this.#vt=t,this.#mt=t*Math.cos(this.#bt),this.#wt=t*Math.sin(this.#bt)}get magnitude(){return this.#vt}set r(t){this.magnitude=t}get r(){return this.magnitude}static add(t,e){return new r(t.x,t.y).add(e)}static subtract(t,e){return new r(t.x,t.y).subtract(e)}static multiply(t,e){return new r(t.x,t.y).multiply(e)}static divide(t,e){return new r(t.x,t.y).divide(e)}static dot(t,e){return new r(t.x,t.y).dot(e)}static cross(t,e){return new r(t.x,t.y).cross(e)}static transform(t,e){return new r(t.x,t.y).transform(e)}static translate(t,e){return new r(t.x,t.y).translate(e)}static rotate(t,e){return new r(t.x,t.y).rotate(e)}static scale(t,e){return new r(t.x,t.y).scale(e)}static normalize(t){return new r(t.x,t.y).normalize()}static fromPolar(t,e){return new r(e*Math.cos(t),e*Math.sin(t))}}}},n={};function h(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={exports:{}};return r[t](i,i.exports,h),i.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},h.a=(r,n,h)=>{var o;h&&((o=[]).d=-1);var a,l,c,u=new Set,p=r.exports,g=new Promise(((t,e)=>{c=e,l=t}));g[e]=p,g[t]=t=>(o&&t(o),u.forEach(t),g.catch((t=>{}))),r.exports=g,n((r=>{var n;a=(r=>r.map((r=>{if(null!==r&&"object"==typeof r){if(r[t])return r;if(r.then){var n=[];n.d=0,r.then((t=>{h[e]=t,s(n)}),(t=>{h[i]=t,s(n)}));var h={};return h[t]=t=>t(n),h}}var o={};return o[t]=t=>{},o[e]=r,o})))(r);var h=()=>a.map((t=>{if(t[i])throw t[i];return t[e]})),l=new Promise((e=>{(n=()=>e(h)).r=0;var i=t=>t!==o&&!u.has(t)&&(u.add(t),t&&!t.d&&(n.r++,t.push(n)));a.map((e=>e[t](i)))}));return n.r?l:h()}),(t=>(t?c(g[i]=t):l(p),s(o)))),o&&o.d<0&&(o.d=0)},h.d=(t,e)=>{for(var i in e)h.o(e,i)&&!h.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},h.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),h(156)})();